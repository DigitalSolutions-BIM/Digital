<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>إنشاء حساب جديد</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase Dependencies -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div class="auth-container">
        <h1>إنشاء حساب جديد</h1>
        <form id="signup-form">
            <div class="form-group">
                <label for="email">البريد الإلكتروني:</label>
                <input type="email" id="email" required autocomplete="email">
            </div>
            
            <div class="form-group">
                <label for="password">كلمة المرور:</label>
                <input type="password" id="password" minlength="6" required autocomplete="new-password">
            </div>
            
            <button type="submit" id="submit-btn">إنشاء حساب</button>
            <div id="error-message" class="error-message"></div>
            <div id="loading" class="loading" style="display: none;">
                جاري إنشاء الحساب...
            </div>
        </form>
        
        <p class="auth-link">
            لديك حساب بالفعل؟ <a href="login.html">سجل الدخول هنا</a>
        </p>
    </div>

<script>
    // الحصول على كائن الـ auth من Firebase
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        toggleLoading(true);
        
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const errorElement = document.getElementById('error-message');

        try {
            // إنشاء المستخدم في Authentication
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;

            // حفظ بيانات إضافية في Firestore
            await db.collection('users').doc(user.uid).set({
                email: email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            // إرسال بريد التحقق (اختياري)
            await user.sendEmailVerification();
            
            window.location.href = 'index.html';
        } catch (error) {
            let errorMessage = 'حدث خطأ أثناء إنشاء الحساب';
            switch (error.code) {
                case 'auth/email-already-in-use':
                    errorMessage = 'البريد الإلكتروني مستخدم بالفعل';
                    break;
                case 'auth/invalid-email':
                    errorMessage = 'بريد إلكتروني غير صالح';
                    break;
                case 'auth/weak-password':
                    errorMessage = 'كلمة المرور يجب أن تكون 6 أحرف على الأقل';
                    break;
                case 'auth/operation-not-allowed':
                    errorMessage = 'عملية غير مسموح بها';
                    break;
            }
            errorElement.textContent = errorMessage;
        } finally {
            toggleLoading(false);
        }
    });
</script>
